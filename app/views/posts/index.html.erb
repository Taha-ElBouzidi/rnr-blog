<div class="container">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">All Posts</h1>
    <% if current_user %>
      <%= link_to "Create Post", new_post_path, data: { turbo_frame: "new_post_frame" }, class: "btn btn-success" %>
    <% end %>
  </div>

  <%= turbo_frame_tag "new_post_frame" %>

  <!-- Tabs Navigation -->
  <% if current_user %>
    <div class="flex gap-1 mb-4 border-b border-gray-200">
      <%= link_to "All Posts", posts_path(q: params[:q], author_id: params[:author_id]), 
          data: { turbo_action: "advance" },
          class: "px-4 py-2 font-medium text-sm transition-colors #{params[:status].blank? ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-900'}" %>
      <%= link_to "Published", posts_path(status: 'published', q: params[:q], author_id: params[:author_id]), 
          data: { turbo_action: "advance" },
          class: "px-4 py-2 font-medium text-sm transition-colors #{params[:status] == 'published' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-900'}" %>
      <%= link_to "My Drafts", posts_path(status: 'drafts', q: params[:q], author_id: params[:author_id]), 
          data: { turbo_action: "advance" },
          class: "px-4 py-2 font-medium text-sm transition-colors #{params[:status] == 'drafts' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-900'}" %>
    </div>
  <% end %>

  <!-- Search and Filters -->
  <div class="card">
    <%= form_with url: posts_path, method: :get, data: { turbo_action: "advance", controller: "autosubmit" }, class: "flex gap-2 flex-wrap" do |f| %>
      <%= f.hidden_field :status, value: params[:status] %>
      <%= f.text_field :q, value: params[:q], placeholder: "Search posts...", class: "form-input flex-1 min-w-[200px]", data: { action: "input->autosubmit#submit", autosubmit_target: "search" } %>
      
      <%= f.select :author_id,
          options_for_select([['All Authors', '']] + @authors.map { |u| [u.name || u.email, u.id] }, params[:author_id]),
          {},
          class: "form-select", data: { action: "change->autosubmit#submit" } %>
      
      <button type="button" data-action="click->autosubmit#clear" class="btn btn-secondary">Clear</button>
    <% end %>
  </div>

  <%= turbo_frame_tag "posts" do %>
    <% if @posts.any? %>
      <%= render @posts %>
    <% else %>
      <%= render "empty_state" %>
    <% end %>
  <% end %>
</div>
